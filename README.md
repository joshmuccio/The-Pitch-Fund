# The Pitch Fund

> **A Next.js 14 application for venture capital portfolio management with role-based access for Limited Partners (LPs) and public company showcasing.**

**ğŸ¯ Goal:** Spin up the full-stack dev environment (Next.js 14 + Supabase + Plasmic + Vercel) for **thepitch.fund** in < 30 min.

---

## ğŸ—ï¸ Tech Stack

- **Frontend**: Next.js 14.2.30 with TypeScript & Tailwind CSS
- **Database**: Supabase (PostgreSQL with Row Level Security)
- **Authentication**: Supabase Auth  
- **CMS**: Plasmic (visual page builder)
- **Deployment**: Vercel
- **AI Features**: Vector embeddings for Q&A (pgvector)

---

## ğŸ“‹ Quick-Start Setup

| âœ… | Step | Commands & Notes |
|----|------|------------------|
| âœ… | **Clone repo** | ```bash<br>git clone https://github.com/joshmuccio/The-Pitch-Fund.git<br>cd "The Pitch Fund"<br>``` |
| âœ… | **Install dependencies** | ```bash<br>npm install<br>npm audit fix --force  # security patches<br>``` |
| â˜ | **Environment setup** | Create `.env.local`:<br>```env<br>NEXT_PUBLIC_SUPABASE_URL=https://[project].supabase.co<br>NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...<br>SUPABASE_SERVICE_ROLE_KEY=eyJ...  # optional<br>PLASMIC_PROJECT_ID=xxxx<br>PLASMIC_PUBLIC_TOKEN=pt__xxxx<br>GOOGLE_ANALYTICS_ID=G-XXXXXXX<br>``` |
| âœ… | **Supabase CLI** | ```bash<br># âŒ DON'T USE: npm i -g supabase (deprecated!)<br>brew install supabase/tap/supabase  # âœ… macOS<br>supabase login<br>supabase init  # answer 'N' to Deno questions<br>``` |
| âœ… | **Database setup** | ```bash<br># âœ… DONE: Migration already applied<br># File: supabase/migrations/20250625012321_initial_schema.sql<br>supabase db push  # if needed<br>``` |
| â˜ | **Create admin user** | 1. Supabase Dashboard â†’ Auth â†’ "Invite User"<br>2. SQL Editor: `insert into profiles (id, role) values ('<user_uid>', 'admin');` |
| â˜ | **Plasmic integration** | 1. [plasmic.app](https://plasmic.app) â†’ New project "The Pitch Fund"<br>2. Copy Project ID & Token â†’ `.env.local`<br>3. `npm run plasmic:sync` |
| â˜ | **Start dev server** | `npm run dev` â†’ [localhost:3000](http://localhost:3000) |
| â˜ | **Deploy to Vercel** | 1. [vercel.com](https://vercel.com) â†’ Import project<br>2. Add environment variables<br>3. Deploy â†’ `https://thepitch-fund.vercel.app` |

---

## ğŸš€ Development Commands

| Purpose | Command |
|---------|---------|
| **Local development** | `npm run dev` |
| **Production build** | `npm run build && npm start` |
| **Sync Plasmic changes** | `npm run plasmic:sync` |
| **Database migrations** | `supabase db push` |
| **Local Supabase Studio** | `supabase studio` |
| **Generate types** | `supabase gen types typescript --local > types/supabase.ts` |

---

## ğŸ“Š Database Architecture

### User Roles & Access Control

- **ğŸŒ Public** - View basic company information
- **ğŸ’¼ LP (Limited Partners)** - Access private metrics and founder updates  
- **ğŸ‘‘ Admin** - Full CRUD access to all data

### Database Tables

```sql
profiles         â†’ User roles (admin/lp) linked to Supabase Auth
companies        â†’ Portfolio companies (PUBLIC ACCESS)
â”œâ”€â”€ kpis         â†’ Key performance indicators (LP-ONLY)
â”‚   â””â”€â”€ kpi_values â†’ Time-series metrics data
â”œâ”€â”€ founder_updates â†’ Periodic company communications (LP-ONLY)
â””â”€â”€ embeddings   â†’ AI vector data for Q&A features (LP-ONLY)
```

### Row Level Security (RLS)

All tables use PostgreSQL RLS policies:
- **Public users**: Basic company info only
- **LPs**: Financial metrics + founder communications  
- **Admins**: Full database access

---

## ğŸ—‚ï¸ Project Structure

```
The Pitch Fund/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router pages
â”‚   â”œâ”€â”€ components/             # React + Plasmic components  
â”‚   â””â”€â”€ lib/                    # Supabase client, utilities
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ migrations/             # Database schema versions
â”‚   â”œâ”€â”€ sql/                    # Reference schema files
â”‚   â””â”€â”€ config.toml             # Local development config
â”œâ”€â”€ plasmic-loader/             # Auto-generated by Plasmic
â”œâ”€â”€ .env.local                  # Environment variables (gitignored)
â””â”€â”€ tailwind.config.js          # Styling configuration
```

---

## ğŸ”§ Database Management

### Creating Migrations

```bash
# Create new migration
supabase migration new add_new_feature

# Edit the generated file
# supabase/migrations/[timestamp]_add_new_feature.sql

# Apply to remote database
supabase db push
```

### Common Queries

```sql
-- Get all public companies
SELECT slug, name, tagline, industry_tags FROM companies;

-- Get LP-accessible KPI data
SELECT k.label, k.unit, kv.period_date, kv.value
FROM kpis k JOIN kpi_values kv ON k.id = kv.kpi_id
WHERE k.company_id = 'uuid' ORDER BY kv.period_date DESC;

-- Recent founder updates
SELECT period_start, period_end, ai_summary FROM founder_updates
WHERE company_id = 'uuid' ORDER BY period_start DESC LIMIT 5;
```

---

## ğŸš¨ Troubleshooting

| Issue | Solution |
|-------|----------|
| **`supabase: command not found`** | Use `brew install supabase/tap/supabase` (NOT npm global) |
| **"No tables after db push"** | Ensure schema is in `supabase/migrations/`, not just `sql/` |
| **GitHub push fails (large files)** | Check `.gitignore` excludes `node_modules/`, `.next/` |
| **"Permission denied for table"** | Verify user role in `profiles` table and RLS policies |
| **Vercel build fails** | Add all environment variables in Vercel â†’ Settings |
| **Internal server error** | Clear `.next/` cache: `rm -rf .next && npm run dev` |

---

## ğŸ” Security & Best Practices

- âœ… **Environment variables** properly gitignored (`.env.local`)
- âœ… **Row Level Security** enabled on all tables
- âœ… **Next.js 14.2.30** security-patched version
- âœ… **Comprehensive `.gitignore** excludes sensitive files
- âœ… **Database migrations** version-controlled
- âœ… **TypeScript** for type safety

---

## ğŸ“š Additional Resources

- **Supabase Docs**: [supabase.com/docs](https://supabase.com/docs)
- **Next.js Docs**: [nextjs.org/docs](https://nextjs.org/docs)  
- **Plasmic Docs**: [docs.plasmic.app](https://docs.plasmic.app)
- **Database Schema**: See `DATABASE.md` for detailed schema documentation
- **Setup Issues**: See `SETUP_GUIDE.md` for troubleshooting gotchas

---

## ğŸ¤ Contributing

1. Fork the repository
2. Create feature branch: `git checkout -b feature/amazing-feature`
3. Make changes and test thoroughly
4. Commit: `git commit -m "feat: add amazing feature"`
5. Push: `git push origin feature/amazing-feature`
6. Open Pull Request

---

### ğŸš€ Happy shipping!  
Questions? Ping @Josh on Slack or open an issue. PRs welcome! ğŸ™

---

**Note for Future AI Assistants**: This project uses Supabase with Next.js. Database schema is in `supabase/migrations/` and must be applied using `supabase db push`. Never use `npm install -g supabase` - always use Homebrew on macOS. The `.gitignore` prevents committing `node_modules` and other large files to avoid GitHub's 100MB limit.